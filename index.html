<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>KN Management ğŸ‘‘</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cairo&display=swap');
    * {
      box-sizing: border-box;
      font-family: 'Cairo', sans-serif;
    }
    body {
      margin: 0;
      background: #f0f4f8;
      color: #333;
      display: flex;
      height: 100vh;
      overflow: hidden;
    }
    #sidebar {
      background: #1e40af; /* Ø£Ø²Ø±Ù‚ ØºØ§Ù…Ù‚ */
      color: white;
      width: 280px;
      min-width: 280px;
      display: flex;
      flex-direction: column;
      padding: 20px;
    }
    #sidebar h1 {
      font-size: 24px;
      margin: 0 0 20px;
      font-weight: 900;
      user-select: none;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    #sidebar h1 span.crown {
      font-size: 28px;
      color: gold;
    }
    #sidebar button {
      background: transparent;
      border: none;
      color: white;
      padding: 14px 10px;
      font-size: 18px;
      text-align: right;
      cursor: pointer;
      border-radius: 6px;
      margin-bottom: 10px;
      transition: background 0.3s ease;
      user-select: none;
    }
    #sidebar button:hover,
    #sidebar button.active {
      background: #3b82f6;
    }
    #sidebar .logout-btn {
      margin-top: auto;
      padding: 14px 10px;
      background: #ef4444;
      font-weight: bold;
      border-radius: 6px;
      transition: background 0.3s ease;
    }
    #sidebar .logout-btn:hover {
      background: #dc2626;
    }

    #mainContent {
      flex: 1;
      overflow-y: auto;
      padding: 30px 40px;
      background: white;
      border-radius: 0 20px 20px 0;
      box-shadow: 0 0 30px rgb(0 0 0 / 0.1);
      margin-left: 10px;
    }
    h1, h2 {
      margin-bottom: 20px;
      color: #1e3a8a;
    }
    p {
      font-size: 18px;
      line-height: 1.5;
    }

    /* Ø£Ø²Ø±Ø§Ø± */
    .actionBtn {
      background: #2563eb;
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      font-size: 17px;
      cursor: pointer;
      transition: background 0.3s ease;
      user-select: none;
      margin-top: 15px;
    }
    .actionBtn:hover {
      background: #1d4ed8;
    }

    /* Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 30px;
    }
    table th, table td {
      padding: 12px 10px;
      border: 1px solid #ddd;
      text-align: center;
      font-size: 16px;
    }
    table th {
      background: #2563eb;
      color: white;
      user-select: none;
    }
    table tr:nth-child(even) {
      background: #f9fafb;
    }

    /* Ø¥Ø¯Ø®Ø§Ù„Ø§Øª Ø§Ù„Ù†Øµ */
    input[type="text"],
    input[type="password"],
    input[type="number"],
    select,
    textarea {
      width: 100%;
      padding: 10px 12px;
      font-size: 16px;
      border: 1.8px solid #cbd5e1;
      border-radius: 8px;
      margin-top: 6px;
      margin-bottom: 15px;
      resize: vertical;
      transition: border-color 0.3s ease;
    }
    input[type="text"]:focus,
    input[type="password"]:focus,
    input[type="number"]:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 5px #2563ebaa;
    }

    /* Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ */
    #messageBox {
      position: fixed;
      top: 15px;
      left: 50%;
      transform: translateX(-50%);
      min-width: 300px;
      background-color: #34d399; /* Ø£Ø®Ø¶Ø± */
      color: white;
      padding: 12px 20px;
      border-radius: 10px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
      font-weight: 700;
      user-select: none;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.4s ease;
      z-index: 9999;
    }
    #messageBox.error {
      background-color: #ef4444; /* Ø£Ø­Ù…Ø± */
    }

    /* ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
    #loginForm {
      max-width: 400px;
      margin: auto;
      background: white;
      padding: 30px 35px;
      margin-top: 120px;
      border-radius: 14px;
      box-shadow: 0 0 40px rgb(0 0 0 / 0.1);
    }
    #loginForm h2 {
      margin-bottom: 30px;
      color: #1e40af;
      text-align: center;
    }
    #loginForm button {
      width: 100%;
      margin-top: 15px;
    }

    /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­Ø¸Ø± */
    .ban-btn {
      background: #ef4444;
      border: none;
      color: white;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 700;
      transition: background 0.3s ease;
      user-select: none;
    }
    .ban-btn:hover {
      background: #dc2626;
    }
    .unban-btn {
      background: #22c55e;
      border: none;
      color: white;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 700;
      transition: background 0.3s ease;
      user-select: none;
    }
    .unban-btn:hover {
      background: #16a34a;
    }

    /* Ø­Ù‚Ù„ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø±ØªØ¨Ø© ÙÙŠ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… */
    .role-select {
      padding: 5px 10px;
      font-size: 15px;
      border-radius: 6px;
      border: 1.5px solid #94a3b8;
      cursor: pointer;
      user-select: none;
    }
  </style>
</head>
<body>

<div id="app"></div>
<div id="messageBox"></div>

<script>
(() => {
  const ADMIN_PASSWORD = '112233';

  // Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
  const storageKeyUsers = 'kn_users';
  const storageKeyLogs = 'kn_logs';
  const storageKeyBans = 'kn_bans';

  // Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ø§Ù„ÙŠØ©
  let currentUser = null;
  let users = JSON.parse(localStorage.getItem(storageKeyUsers)) || [];
  let logs = JSON.parse(localStorage.getItem(storageKeyLogs)) || [];
  let bans = JSON.parse(localStorage.getItem(storageKeyBans)) || [];

  // Ø¹Ù†Ø§ØµØ± DOM
  const app = document.getElementById('app');
  const messageBox = document.getElementById('messageBox');

  // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© ØªÙ†Ø¨ÙŠÙ‡
  function showMessage(msg, type = 'success', duration = 2500) {
    messageBox.textContent = msg;
    messageBox.className = '';
    if(type === 'error') messageBox.classList.add('error');
    messageBox.style.opacity = '1';
    setTimeout(() => {
      messageBox.style.opacity = '0';
    }, duration);
  }

  // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ localStorage
  function saveAll() {
    localStorage.setItem(storageKeyUsers, JSON.stringify(users));
    localStorage.setItem(storageKeyLogs, JSON.stringify(logs));
    localStorage.setItem(storageKeyBans, JSON.stringify(bans));
  }

  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø¸Ø±
  function isBanned(username) {
    return bans.includes(username);
  }

  // ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø¹ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ù„Ù„Ø§Ø¯Ù…Ù† ÙÙ‚Ø·
  function login(username, role, password = '') {
    if(!username.trim() || !role.trim()) return false;
    if(role === 'Ø£Ø¯Ù…Ù†' && password !== ADMIN_PASSWORD) {
      showMessage('ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„Ø£Ø¯Ù…Ù† ØºÙŠØ± ØµØ­ÙŠØ­Ø©!', 'error');
      return false;
    }
    if(isBanned(username)) {
      showMessage('ØªÙ… Ø­Ø¸Ø±Ùƒ Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù…ØŒ Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¯Ø®ÙˆÙ„.', 'error');
      return false;
    }
    currentUser = { username, role, loginTime: Date.now(), points: 0 };
    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙÙŠ Ø§Ù„Ù„ÙˆÙ‚
    logs.push({
      type: 'Ø¯Ø®ÙˆÙ„',
      username,
      role,
      time: new Date().toLocaleString()
    });
    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø¥Ø°Ø§ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯
    if(!users.find(u => u.username === username)) {
      users.push({ username, role, points: 0 });
    } else {
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ØªØ¨Ø© ÙÙŠ Ø­Ø§Ù„ ØªØºÙŠØ±Øª
      const user = users.find(u => u.username === username);
      user.role = role;
    }
    saveAll();
    return true;
  }

  // ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
  function logout() {
    if(!currentUser) return;
    // Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆÙ‚Øª Ø¨Ø§Ù„ÙØªØ±Ø© ÙˆØ¥Ø¹Ø·Ø§Ø¡ Ù†Ù‚Ø§Ø· (Ù†Ù‚Ø·Ø© Ù„ÙƒÙ„ Ø³Ø§Ø¹ØªÙŠÙ†)
    const sessionTimeMs = Date.now() - currentUser.loginTime;
    const hours = sessionTimeMs / (1000 * 3600);
    const earnedPoints = Math.floor(hours / 2);
    currentUser.points += earnedPoints;

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
    const user = users.find(u => u.username === currentUser.username);
    if(user) {
      user.points = (user.points || 0) + earnedPoints;
      user.role = currentUser.role; // ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø±ØªØ¨Ø©
    }

    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ ÙÙŠ Ø§Ù„Ù„ÙˆÙ‚
    logs.push({
      type: 'Ø®Ø±ÙˆØ¬',
      username: currentUser.username,
      role: currentUser.role,
      time: new Date().toLocaleString()
    });

    saveAll();
    currentUser = null;
  }

  // ØªÙ‚Ø¯ÙŠÙ… Ø¥Ø¬Ø§Ø²Ø©
  function submitLeave(reason, duration) {
    if(!currentUser) return false;
    if(reason.length < 3 || isNaN(duration) || duration < 1) return false;

    logs.push({
      type: 'Ø¥Ø¬Ø§Ø²Ø©',
      username: currentUser.username,
      role: currentUser.role,
      reason,
      duration,
      time: new Date().toLocaleString()
    });
    saveAll();
    return true;
  }

  // Ø­Ø¸Ø± Ù…Ø³ØªØ®Ø¯Ù…
  function banUser(username) {
    if(!bans.includes(username)) bans.push(username);
    saveAll();
  }
  // Ø±ÙØ¹ Ø§Ù„Ø­Ø¸Ø±
  function unbanUser(username) {
    bans = bans.filter(u => u !== username);
    saveAll();
  }

  // ØªØºÙŠÙŠØ± Ø±ØªØ¨Ø© Ù…Ø³ØªØ®Ø¯Ù… (Ù„Ù„Ø§Ø§Ø¯Ù…Ù† ÙÙ‚Ø·)
  function changeUserRole(username, newRole) {
    if(currentUser.role !== 'Ø£Ø¯Ù…Ù†') {
      showMessage('Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© ØªØºÙŠÙŠØ± Ø§Ù„Ø±ØªØ¨', 'error');
      return false;
    }
    const user = users.find(u => u.username === username);
    if(user) {
      user.role = newRole;
      saveAll();
      showMessage(`ØªÙ… ØªØºÙŠÙŠØ± Ø±ØªØ¨Ø© ${username} Ø¥Ù„Ù‰ ${newRole}`, 'success');
      return true;
    }
    return false;
  }

  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù‚Ø§Ø· ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
  function updatePoints() {
    if(!currentUser) return;
    // ØªØ­Ø¯ÙŠØ« Ù†Ù‚Ø§Ø· Ø§Ù„Ø¬Ù„Ø³Ø© Ø­Ø³Ø¨ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ
    const sessionTimeMs = Date.now() - currentUser.loginTime;
    const hours = sessionTimeMs / (1000 * 3600);
    const earnedPoints = Math.floor(hours / 2);
    currentUser.points = (users.find(u => u.username === currentUser.username)?.points || 0) + earnedPoints;
  }

  // === Ø¹Ø±Ø¶ Ø§Ù„ØµÙØ­Ø§Øª ===

  // ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
  function renderLogin() {
    app.innerHTML = `
      <form id="loginForm" autocomplete="off" onsubmit="return false;">
        <h2>KN Management ğŸ‘‘</h2>
        <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</label>
        <input type="text" id="loginUsername" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" required />

        <label>Ø§Ù„Ø±ØªØ¨Ø©:</label>
        <select id="loginRole" required>
          <option value="" disabled selected>Ø§Ø®ØªØ± Ø±ØªØ¨ØªÙƒ</option>
          <option value="Ø¹Ø¶Ùˆ">Ø¹Ø¶Ùˆ</option>
          <option value="Ù…Ø´Ø±Ù">Ù…Ø´Ø±Ù</option>
          <option value="Ø£Ø¯Ù…Ù†">Ø£Ø¯Ù…Ù†</option>
        </select>

        <div id="adminPasswordDiv" style="display:none;">
          <label>ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„Ø£Ø¯Ù…Ù†:</label>
          <input type="password" id="loginAdminPassword" placeholder="ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„Ø£Ø¯Ù…Ù†" />
        </div>

        <button type="submit" class="actionBtn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
      </form>
    `;

    const roleSelect = document.getElementById('loginRole');
    const adminPassDiv = document.getElementById('adminPasswordDiv');
    const loginForm = document.getElementById('loginForm');

    roleSelect.onchange = () => {
      if(roleSelect.value === 'Ø£Ø¯Ù…Ù†') {
        adminPassDiv.style.display = 'block';
      } else {
        adminPassDiv.style.display = 'none';
      }
    };

    loginForm.onsubmit = () => {
      const username = document.getElementById('loginUsername').value.trim();
      const role = document.getElementById('loginRole').value;
      const password = document.getElementById('loginAdminPassword').value;
      if(login(username, role, password)) {
        showMessage('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­');
        renderApp('dashboard');
      }
      return false;
    };
  }

  // Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
  function renderSidebar(activePage) {
    if(!currentUser) return '';
    return `
      <div id="sidebar">
        <h1>KN Management <span class="crown">ğŸ‘‘</span></h1>
        <button data-page="dashboard" class="${activePage === 'dashboard' ? 'active' : ''}">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
        <button data-page="leave" class="${activePage === 'leave' ? 'active' : ''}">ØªÙ‚Ø¯ÙŠÙ… Ø¥Ø¬Ø§Ø²Ø©</button>
        <button data-page="logs" class="${activePage === 'logs' ? 'active' : ''}">Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„Ø®Ø±ÙˆØ¬</button>
        ${(currentUser.role === 'Ø£Ø¯Ù…Ù†' || currentUser.role === 'Ù…Ø´Ø±Ù') ? `<button data-page="users" class="${activePage === 'users' ? 'active' : ''}">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</button>` : ''}
        ${(currentUser.role === 'Ø£Ø¯Ù…Ù†' || currentUser.role === 'Ù…Ø´Ø±Ù') ? `<button data-page="bans" class="${activePage === 'bans' ? 'active' : ''}">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø§Ù„Ù…Ø­Ø¸ÙˆØ±ÙˆÙ†</button>` : ''}
        <button id="logoutBtnSidebar" class="logout-btn">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
      </div>
    `;
  }

  // ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
  function renderDashboard() {
    updatePoints();
    const { username, role, points } = currentUser;
    return `
      <h1>Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ ${username}!</h1>
      <p><strong>Ø±ØªØ¨ØªÙƒ:</strong> ${role}</p>
      <p><strong>Ù†Ù‚Ø§Ø·Ùƒ Ø§Ù„Ù…ÙƒØªØ³Ø¨Ø©:</strong> ${points}</p>
      <p>ÙŠÙ…ÙƒÙ†Ùƒ ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨ Ø¥Ø¬Ø§Ø²Ø© Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©.</p>
    `;
  }

  // ØµÙØ­Ø© ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©
  function renderLeave() {
    return `
      <h2>ØªÙ‚Ø¯ÙŠÙ… Ø¥Ø¬Ø§Ø²Ø©</h2>
      <label>Ø§Ù„Ø³Ø¨Ø¨:</label>
      <textarea id="leaveReason" rows="4" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¨Ø¨ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø© Ù‡Ù†Ø§..." required></textarea>

      <label>Ù…Ø¯Ø© Ø§Ù„Ø¥Ø¬Ø§Ø²Ø© (Ø¨Ø§Ù„Ø£ÙŠØ§Ù…):</label>
      <input type="number" id="leaveDuration" min="1" value="1" required />

      <button class="actionBtn" id="submitLeaveBtn">ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©</button>
    `;
  }

  // ØµÙØ­Ø© Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„Ø®Ø±ÙˆØ¬ ÙˆØ§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª
  function renderLogs() {
    if(!(currentUser.role === 'Ø£Ø¯Ù…Ù†' || currentUser.role === 'Ù…Ø´Ø±Ù')) {
      return `<p style="color:#dc2626; font-weight:bold;">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„Ø§Øª.</p>`;
    }
    if(logs.length === 0) return `<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</p>`;

    // ØªØµÙ†ÙŠÙ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹ Ù…Ø¹ Ø£Ù„ÙˆØ§Ù† Ù…Ø®ØªÙ„ÙØ©
    function logRow(log) {
      let details = '';
      if(log.type === 'Ø¥Ø¬Ø§Ø²Ø©') {
        details = `Ø³Ø¨Ø¨: ${log.reason} - Ù…Ø¯Ø©: ${log.duration} ÙŠÙˆÙ…`;
      }
      return `
        <tr>
          <td>${log.type}</td>
          <td>${log.username}</td>
          <td>${log.role}</td>
          <td>${details}</td>
          <td>${log.time}</td>
        </tr>
      `;
    }

    return `
      <h2>Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„Ø®Ø±ÙˆØ¬ ÙˆØ§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª</h2>
      <table>
        <thead>
          <tr>
            <th>Ø§Ù„Ù†ÙˆØ¹</th>
            <th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
            <th>Ø§Ù„Ø±ØªØ¨Ø©</th>
            <th>Ø§Ù„ØªÙØ§ØµÙŠÙ„</th>
            <th>Ø§Ù„ÙˆÙ‚Øª</th>
          </tr>
        </thead>
        <tbody>
          ${logs.map(logRow).join('')}
        </tbody>
      </table>
    `;
  }

  // ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† (ØªØºÙŠÙŠØ± Ø§Ù„Ø±ØªØ¨ ÙˆØ§Ù„Ø­Ø¸Ø±)
  function renderUsers() {
    if(currentUser.role !== 'Ø£Ø¯Ù…Ù†' && currentUser.role !== 'Ù…Ø´Ø±Ù') {
      return `<p style="color:#dc2626; font-weight:bold;">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ø¹Ø±Ø¶ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©.</p>`;
    }
    if(users.length === 0) return `<p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ù…Ø³Ø¬Ù„ÙˆÙ†.</p>`;

    function userRow(user) {
      const isBannedUser = isBanned(user.username);
      const canChangeRole = currentUser.role === 'Ø£Ø¯Ù…Ù†';
      const roleOptions = ['Ø¹Ø¶Ùˆ', 'Ù…Ø´Ø±Ù', 'Ø£Ø¯Ù…Ù†'].map(r => {
        return `<option value="${r}" ${r === user.role ? 'selected' : ''}>${r}</option>`;
      }).join('');

      return `
        <tr>
          <td>${user.username}</td>
          <td>
            ${canChangeRole ? `<select class="role-select" data-username="${user.username}">${roleOptions}</select>` : user.role}
          </td>
          <td>${user.points || 0}</td>
          <td>
            ${isBannedUser ? 
              `<button class="unban-btn" data-username="${user.username}">Ø±ÙØ¹ Ø§Ù„Ø­Ø¸Ø±</button>` : 
              `<button class="ban-btn" data-username="${user.username}">Ø­Ø¸Ø±</button>`
            }
          </td>
        </tr>
      `;
    }

    return `
      <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h2>
      <table>
        <thead>
          <tr>
            <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
            <th>Ø§Ù„Ø±ØªØ¨Ø©</th>
            <th>Ø§Ù„Ù†Ù‚Ø§Ø·</th>
            <th>Ø§Ù„Ø­Ø¸Ø±</th>
          </tr>
        </thead>
        <tbody>
          ${users.map(userRow).join('')}
        </tbody>
      </table>
    `;
  }

  // ØµÙØ­Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø§Ù„Ù…Ø­Ø¸ÙˆØ±ÙˆÙ†
  function renderBans() {
    if(currentUser.role !== 'Ø£Ø¯Ù…Ù†' && currentUser.role !== 'Ù…Ø´Ø±Ù') {
      return `<p style="color:#dc2626; font-weight:bold;">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ø¹Ø±Ø¶ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©.</p>`;
    }
    if(bans.length === 0) return `<p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ù…Ø­Ø¸ÙˆØ±ÙˆÙ†.</p>`;

    return `
      <h2>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø§Ù„Ù…Ø­Ø¸ÙˆØ±ÙˆÙ†</h2>
      <ul>
        ${bans.map(username => `
          <li>
            ${username} 
            <button class="unban-btn" data-username="${username}">Ø±ÙØ¹ Ø§Ù„Ø­Ø¸Ø±</button>
          </li>
        `).join('')}
      </ul>
    `;
  }

  // Ø¹Ø±Ø¶ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù…Ø¹ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ
  function renderApp(page = 'dashboard') {
    if(!currentUser) {
      renderLogin();
      return;
    }
    app.innerHTML = `
      ${renderSidebar(page)}
      <main id="mainContent"></main>
    `;

    const mainContent = document.getElementById('mainContent');

    switch(page) {
      case 'dashboard':
        mainContent.innerHTML = renderDashboard();
        break;
      case 'leave':
        mainContent.innerHTML = renderLeave();
        break;
      case 'logs':
        mainContent.innerHTML = renderLogs();
        break;
      case 'users':
        mainContent.innerHTML = renderUsers();
        break;
      case 'bans':
        mainContent.innerHTML = renderBans();
        break;
      default:
        mainContent.innerHTML = `<p>Ø§Ù„ØµÙØ­Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©</p>`;
    }

    // Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
    // Ø§Ù„ØªÙ†Ù‚Ù„ ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ
    document.querySelectorAll('#sidebar button[data-page]').forEach(btn => {
      btn.onclick = () => {
        renderApp(btn.getAttribute('data-page'));
      };
    });

    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
    document.getElementById('logoutBtnSidebar').onclick = () => {
      logout();
      showMessage('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­');
      renderLogin();
    };

    // ØªÙ‚Ø¯ÙŠÙ… Ø¥Ø¬Ø§Ø²Ø©
    const submitLeaveBtn = document.getElementById('submitLeaveBtn');
    if(submitLeaveBtn) {
      submitLeaveBtn.onclick = () => {
        const reason = document.getElementById('leaveReason').value.trim();
        const duration = parseInt(document.getElementById('leaveDuration').value, 10);
        if(submitLeave(reason, duration)) {
          showMessage('ØªÙ… ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø© Ø¨Ù†Ø¬Ø§Ø­');
          renderApp('leave');
        } else {
          showMessage('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¨Ø¨ ÙˆÙ…Ø¯Ø© ØµØ­ÙŠØ­Ø© Ù„Ù„Ø¥Ø¬Ø§Ø²Ø©', 'error');
        }
      };
    }

    // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
    if(page === 'users') {
      // ØªØºÙŠÙŠØ± Ø±ØªØ¨Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
      document.querySelectorAll('.role-select').forEach(select => {
        select.onchange = (e) => {
          const username = e.target.getAttribute('data-username');
          const newRole = e.target.value;
          changeUserRole(username, newRole);
        };
      });
      // Ø­Ø¸Ø± ÙˆØ±ÙØ¹ Ø­Ø¸Ø±
      document.querySelectorAll('.ban-btn').forEach(btn => {
        btn.onclick = () => {
          const username = btn.getAttribute('data-username');
          if(username === currentUser.username) {
            showMessage('Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø­Ø¸Ø± Ù†ÙØ³Ùƒ!', 'error');
            return;
          }
          banUser(username);
          showMessage(`ØªÙ… Ø­Ø¸Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ${username}`);
          renderApp('users');
        };
      });
      document.querySelectorAll('.unban-btn').forEach(btn => {
        btn.onclick = () => {
          const username = btn.getAttribute('data-username');
          unbanUser(username);
          showMessage(`ØªÙ… Ø±ÙØ¹ Ø§Ù„Ø­Ø¸Ø± Ø¹Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ${username}`);
          renderApp('users');
        };
      });
    }

    // ØµÙØ­Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø§Ù„Ù…Ø­Ø¸ÙˆØ±ÙˆÙ†
    if(page === 'bans') {
      document.querySelectorAll('.unban-btn').forEach(btn => {
        btn.onclick = () => {
          const username = btn.getAttribute('data-username');
          unbanUser(username);
          showMessage(`ØªÙ… Ø±ÙØ¹ Ø§Ù„Ø­Ø¸Ø± Ø¹Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ${username}`);
          renderApp('bans');
        };
      });
    }
  }

  // Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
  renderLogin();

})();
</script>

</body>
</html>
